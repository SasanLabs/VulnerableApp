function addMessage(text, sender) {
    var chatHistory = document.getElementById('chatHistory');
    var messageDiv = document.createElement('div');
    messageDiv.classList.add('message');
    if (sender === 'user') {
        messageDiv.classList.add('user-message');
        messageDiv.innerHTML = "<strong>You:</strong> " + text;
    } else {
        messageDiv.classList.add('bot-message');
        messageDiv.innerHTML = "<strong>AI:</strong> " + text;
    }
    chatHistory.appendChild(messageDiv);
    chatHistory.scrollTop = chatHistory.scrollHeight;
}

document.getElementById('sendMessageBtn').addEventListener('click', function () {
    var input = document.getElementById('userMessage');
    var message = input.value;
    if (!message) return;

    addMessage(message, 'user');
    input.value = '';

    var url = getUrlForVulnerabilityLevel();
    doGetAjaxCallWithQueryParams(url, { message: message }, function (response) {
        if (response.isValid) {
            addMessage(response.content, 'bot');
        } else {
            addMessage("Error: " + response.content, 'bot');
        }
    });
});
